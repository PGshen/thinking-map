# Enhanced Multi-Agent System

åŸºäºCloudWeGo/Einoæ¡†æ¶çš„å¢å¼ºå¤šæ™ºèƒ½ä½“ç³»ç»Ÿï¼Œæä¾›äº†é«˜çº§çš„æ€è€ƒã€è§„åˆ’å’Œåä½œèƒ½åŠ›ã€‚

## åŠŸèƒ½ç‰¹æ€§

### ğŸ§  æ™ºèƒ½æ€è€ƒèƒ½åŠ›
- **æ·±åº¦æ€è€ƒæ¨¡å¼**ï¼šæ”¯æŒå¤šæ­¥éª¤æ€è€ƒè¿‡ç¨‹
- **å¤æ‚åº¦åˆ†æ**ï¼šè‡ªåŠ¨è¯„ä¼°ä»»åŠ¡å¤æ‚åº¦
- **æ€è€ƒå†å²è®°å½•**ï¼šå®Œæ•´çš„æ€è€ƒè¿‡ç¨‹è¿½è¸ª

### ğŸ“‹ ä»»åŠ¡è§„åˆ’èƒ½åŠ›
- **åŠ¨æ€è§„åˆ’**ï¼šæ ¹æ®ä»»åŠ¡å¤æ‚åº¦åŠ¨æ€ç”Ÿæˆæ‰§è¡Œè®¡åˆ’
- **ä¾èµ–åˆ†æ**ï¼šè‡ªåŠ¨è¯†åˆ«ä»»åŠ¡é—´çš„ä¾èµ–å…³ç³»
- **è®¡åˆ’æ›´æ–°**ï¼šæ”¯æŒæ‰§è¡Œè¿‡ç¨‹ä¸­çš„è®¡åˆ’è°ƒæ•´

### ğŸ‘¥ å¤šæ™ºèƒ½ä½“åä½œ
- **ä¸“å®¶æ™ºèƒ½ä½“**ï¼šæ”¯æŒå¤šä¸ªä¸“ä¸šé¢†åŸŸçš„æ™ºèƒ½ä½“
- **å¹¶è¡Œæ‰§è¡Œ**ï¼šæ”¯æŒå¤šä¸ªæ™ºèƒ½ä½“å¹¶è¡Œå¤„ç†ä»»åŠ¡
- **ç»“æœèšåˆ**ï¼šæ™ºèƒ½èšåˆå¤šä¸ªæ™ºèƒ½ä½“çš„æ‰§è¡Œç»“æœ

### ğŸ”„ æŒç»­åé¦ˆæœºåˆ¶
- **æ‰§è¡Œç›‘æ§**ï¼šå®æ—¶ç›‘æ§ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€
- **è´¨é‡è¯„ä¼°**ï¼šå¯¹æ‰§è¡Œç»“æœè¿›è¡Œè´¨é‡è¯„ä¼°
- **è‡ªé€‚åº”è°ƒæ•´**ï¼šæ ¹æ®åé¦ˆè‡ªåŠ¨è°ƒæ•´æ‰§è¡Œç­–ç•¥

### ğŸ“Š çŠ¶æ€ç®¡ç†
- **ä¼šè¯ç®¡ç†**ï¼šæ”¯æŒå¤šè½®å¯¹è¯å’Œä¸Šä¸‹æ–‡ä¿æŒ
- **çŠ¶æ€æŒä¹…åŒ–**ï¼šæ”¯æŒçŠ¶æ€çš„åºåˆ—åŒ–å’Œæ¢å¤
- **æ‰§è¡Œå†å²**ï¼šå®Œæ•´çš„æ‰§è¡Œè¿‡ç¨‹è®°å½•

## æ¶æ„è®¾è®¡

### æ ¸å¿ƒç»„ä»¶

1. **ä¸»æ™ºèƒ½ä½“ (Host Agent)**
   - è´Ÿè´£æ•´ä½“åè°ƒå’Œå†³ç­–
   - æ‰§è¡Œæ€è€ƒå’Œè§„åˆ’è¿‡ç¨‹
   - ç®¡ç†ä¸“å®¶æ™ºèƒ½ä½“çš„è°ƒåº¦

2. **ä¸“å®¶æ™ºèƒ½ä½“ (Specialist Agents)**
   - ä¸“é—¨å¤„ç†ç‰¹å®šé¢†åŸŸçš„ä»»åŠ¡
   - æ”¯æŒå¹¶è¡Œæ‰§è¡Œ
   - æä¾›ä¸“ä¸šçš„è§£å†³æ–¹æ¡ˆ

3. **çŠ¶æ€ç®¡ç†å™¨ (State Manager)**
   - ç»´æŠ¤ç³»ç»Ÿçš„å…¨å±€çŠ¶æ€
   - æ”¯æŒçŠ¶æ€çš„åºåˆ—åŒ–å’Œæ¢å¤
   - æä¾›çŠ¶æ€æŸ¥è¯¢å’Œæ›´æ–°æ¥å£

4. **æ‰§è¡Œå¼•æ“ (Execution Engine)**
   - åŸºäºEinoæ¡†æ¶çš„å›¾æ‰§è¡Œå¼•æ“
   - æ”¯æŒå¤æ‚çš„å·¥ä½œæµç¼–æ’
   - æä¾›é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶

### æ‰§è¡Œæµç¨‹

```mermaid
graph TD
    A[ç”¨æˆ·è¾“å…¥] --> B[å¯¹è¯åˆ†æ]
    B --> C[ä¸»æ™ºèƒ½ä½“æ€è€ƒ]
    C --> D{å¤æ‚åº¦åˆ¤æ–­}
    D -->|ç®€å•| E[ç›´æ¥å›ç­”]
    D -->|å¤æ‚| F[åˆ›å»ºæ‰§è¡Œè®¡åˆ’]
    F --> G[ä¸“å®¶æ™ºèƒ½ä½“æ‰§è¡Œ]
    G --> H[ç»“æœæ”¶é›†]
    H --> I[åé¦ˆå¤„ç†]
    I --> J{æ˜¯å¦ç»§ç»­}
    J -->|æ˜¯| K[æ›´æ–°è®¡åˆ’]
    J -->|å¦| L[ç”Ÿæˆæœ€ç»ˆç­”æ¡ˆ]
    K --> G
    E --> M[ç»“æŸ]
    L --> M
```

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ä½¿ç”¨

```go
package main

import (
    "context"
    "fmt"
    "github.com/cloudwego/eino/flow/agent/multiagent/enhanced"
    "github.com/cloudwego/eino/schema"
)

func main() {
    // ä½¿ç”¨é»˜è®¤é…ç½®
    config := enhanced.GetDefaultConfig()
    
    // åˆ›å»ºå¢å¼ºå¤šæ™ºèƒ½ä½“ç³»ç»Ÿ
    ctx := context.Background()
    agent, err := enhanced.NewEnhancedMultiAgent(ctx, config)
    if err != nil {
        panic(err)
    }
    
    // å‡†å¤‡è¾“å…¥æ¶ˆæ¯
    input := []*schema.Message{
        {
            Role:    schema.User,
            Content: "è¯·å¸®æˆ‘åˆ†æä¸€ä¸‹å¦‚ä½•ä¼˜åŒ–Goè¯­è¨€WebæœåŠ¡çš„æ€§èƒ½",
        },
    }
    
    // æ‰§è¡Œ
    result, err := agent.Generate(ctx, input)
    if err != nil {
        panic(err)
    }
    
    fmt.Println("ç»“æœ:", result.Content)
}
```

### æµå¼å¤„ç†

```go
// æµå¼æ‰§è¡Œ
stream, err := agent.Stream(ctx, input)
if err != nil {
    panic(err)
}

for {
    chunk, err := stream.Recv()
    if err != nil {
        if err.Error() == "EOF" {
            break
        }
        panic(err)
    }
    fmt.Print(chunk.Content)
}
```

### è‡ªå®šä¹‰é…ç½®

```go
// åˆ›å»ºè‡ªå®šä¹‰é…ç½®
config := &enhanced.EnhancedMultiAgentConfig{
    Name: "æˆ‘çš„å¤šæ™ºèƒ½ä½“ç³»ç»Ÿ",
    Host: enhanced.EnhancedHost{
        Model: enhanced.ModelConfig{
            Provider: "openai",
            Model:    "gpt-4",
            Parameters: map[string]any{
                "temperature": 0.7,
                "max_tokens":  2048,
            },
        },
        SystemPrompt: "ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½åŠ©æ‰‹...",
        Thinking: enhanced.ThinkingConfig{
            MaxSteps:           5,
            Timeout:            time.Minute * 2,
            EnableDeepThink:    true,
            ComplexityAnalysis: true,
        },
    },
    Specialists: []*enhanced.EnhancedSpecialist{
        {
            Name:        "ä»£ç ä¸“å®¶",
            IntendedUse: "å¤„ç†ç¼–ç¨‹ç›¸å…³ä»»åŠ¡",
            Model: enhanced.ModelConfig{
                Provider: "openai",
                Model:    "gpt-4",
            },
            SystemPrompt: "ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ç¨‹åºå‘˜...",
        },
    },
}

// ä½¿ç”¨é»˜è®¤å€¼å¡«å……å…¶ä»–é…ç½®
defaultConfig := enhanced.GetDefaultConfig()
config.Session = defaultConfig.Session
config.Performance = defaultConfig.Performance
config.Logging = defaultConfig.Logging
config.ExecutionControl = defaultConfig.ExecutionControl
config.System = defaultConfig.System
```

## é…ç½®è¯´æ˜

### ä¸»æ™ºèƒ½ä½“é…ç½® (EnhancedHost)

- `Model`: æ¨¡å‹é…ç½®ï¼ŒåŒ…æ‹¬æä¾›å•†ã€æ¨¡å‹åç§°å’Œå‚æ•°
- `SystemPrompt`: ç³»ç»Ÿæç¤ºè¯
- `Thinking`: æ€è€ƒé…ç½®ï¼Œæ§åˆ¶æ€è€ƒè¿‡ç¨‹çš„è¡Œä¸º
- `Planning`: è§„åˆ’é…ç½®ï¼Œæ§åˆ¶ä»»åŠ¡è§„åˆ’çš„è¡Œä¸º

### ä¸“å®¶æ™ºèƒ½ä½“é…ç½® (EnhancedSpecialist)

- `Name`: ä¸“å®¶åç§°
- `IntendedUse`: é¢„æœŸç”¨é€”æè¿°
- `Model`: æ¨¡å‹é…ç½®
- `SystemPrompt`: ä¸“å®¶çš„ç³»ç»Ÿæç¤ºè¯
- `Concurrency`: å¹¶å‘æ•°é‡
- `Timeout`: æ‰§è¡Œè¶…æ—¶æ—¶é—´

### ä¼šè¯é…ç½® (SessionConfig)

- `HistoryLength`: å†å²è®°å½•é•¿åº¦
- `ContextWindow`: ä¸Šä¸‹æ–‡çª—å£å¤§å°
- `ContextProcessing`: ä¸Šä¸‹æ–‡å¤„ç†é…ç½®

### æ€§èƒ½é…ç½® (PerformanceConfig)

- `Concurrency`: å¹¶å‘æ§åˆ¶é…ç½®
- `MemoryManagement`: å†…å­˜ç®¡ç†é…ç½®
- `Caching`: ç¼“å­˜é…ç½®
- `Monitoring`: ç›‘æ§é…ç½®

## æ‰©å±•å¼€å‘

### è‡ªå®šä¹‰å¤„ç†å™¨

å¯ä»¥é€šè¿‡å®ç°ç›¸åº”çš„æ¥å£æ¥è‡ªå®šä¹‰å¤„ç†å™¨ï¼š

```go
// è‡ªå®šä¹‰å¯¹è¯åˆ†æå™¨
type CustomConversationAnalyzer struct {
    // è‡ªå®šä¹‰å­—æ®µ
}

func (c *CustomConversationAnalyzer) PreHandler(ctx context.Context, input any, state *enhanced.EnhancedState) (any, error) {
    // è‡ªå®šä¹‰é¢„å¤„ç†é€»è¾‘
    return input, nil
}

func (c *CustomConversationAnalyzer) PostHandler(ctx context.Context, output any, state *enhanced.EnhancedState) error {
    // è‡ªå®šä¹‰åå¤„ç†é€»è¾‘
    return nil
}
```

### è‡ªå®šä¹‰å›è°ƒ

```go
// å®ç°è‡ªå®šä¹‰å›è°ƒ
type CustomCallback struct {}

func (c *CustomCallback) OnSystemStart(ctx context.Context, state *enhanced.EnhancedState) error {
    fmt.Println("ç³»ç»Ÿå¯åŠ¨")
    return nil
}

func (c *CustomCallback) OnSystemEnd(ctx context.Context, state *enhanced.EnhancedState) error {
    fmt.Println("ç³»ç»Ÿç»“æŸ")
    return nil
}

// æ›´å¤šå›è°ƒæ–¹æ³•...
```

## æœ€ä½³å®è·µ

### 1. åˆç†é…ç½®ä¸“å®¶æ™ºèƒ½ä½“

- æ ¹æ®ä¸šåŠ¡éœ€æ±‚é…ç½®ä¸“é—¨çš„ä¸“å®¶æ™ºèƒ½ä½“
- ä¸ºæ¯ä¸ªä¸“å®¶è®¾ç½®åˆé€‚çš„ç³»ç»Ÿæç¤ºè¯
- æ§åˆ¶ä¸“å®¶çš„å¹¶å‘æ•°é‡ä»¥å¹³è¡¡æ€§èƒ½å’Œèµ„æºæ¶ˆè€—

### 2. ä¼˜åŒ–æ€è€ƒå’Œè§„åˆ’é…ç½®

- æ ¹æ®ä»»åŠ¡å¤æ‚åº¦è°ƒæ•´æ€è€ƒæ­¥æ•°
- è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´
- å¯ç”¨å¤æ‚åº¦åˆ†æä»¥æé«˜å†³ç­–è´¨é‡

### 3. ç›‘æ§å’Œæ—¥å¿—

- å¯ç”¨è¯¦ç»†çš„æ—¥å¿—è®°å½•
- ç›‘æ§ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡
- å®šæœŸåˆ†ææ‰§è¡Œå†å²ä»¥ä¼˜åŒ–é…ç½®

### 4. é”™è¯¯å¤„ç†

- è®¾ç½®åˆç†çš„é‡è¯•ç­–ç•¥
- å®ç°ä¼˜é›…çš„é™çº§æœºåˆ¶
- è®°å½•å’Œåˆ†æé”™è¯¯æ¨¡å¼

## æ€§èƒ½ä¼˜åŒ–

### 1. å¹¶å‘æ§åˆ¶

- åˆç†è®¾ç½®ä¸“å®¶æ™ºèƒ½ä½“çš„å¹¶å‘æ•°é‡
- ä½¿ç”¨è¿æ¥æ± ç®¡ç†æ¨¡å‹APIè¿æ¥
- å®ç°è¯·æ±‚å»é‡å’Œç¼“å­˜æœºåˆ¶

### 2. å†…å­˜ç®¡ç†

- å®šæœŸæ¸…ç†å†å²è®°å½•
- ä½¿ç”¨æµå¼å¤„ç†å‡å°‘å†…å­˜å ç”¨
- å®ç°çŠ¶æ€çš„å¢é‡æ›´æ–°

### 3. ç½‘ç»œä¼˜åŒ–

- ä½¿ç”¨HTTP/2è¿æ¥å¤ç”¨
- å®ç°æ™ºèƒ½é‡è¯•å’Œç†”æ–­æœºåˆ¶
- ä¼˜åŒ–è¯·æ±‚æ‰¹å¤„ç†

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç¼–è¯‘é”™è¯¯**
   - æ£€æŸ¥Goç‰ˆæœ¬æ˜¯å¦ç¬¦åˆè¦æ±‚
   - ç¡®ä¿æ‰€æœ‰ä¾èµ–åŒ…å·²æ­£ç¡®å®‰è£…

2. **è¿è¡Œæ—¶é”™è¯¯**
   - æ£€æŸ¥æ¨¡å‹APIé…ç½®æ˜¯å¦æ­£ç¡®
   - éªŒè¯ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸

3. **æ€§èƒ½é—®é¢˜**
   - æ£€æŸ¥å¹¶å‘é…ç½®æ˜¯å¦åˆç†
   - ç›‘æ§å†…å­˜å’ŒCPUä½¿ç”¨æƒ…å†µ

### è°ƒè¯•æŠ€å·§

- å¯ç”¨è°ƒè¯•æ¨¡å¼è·å–è¯¦ç»†æ—¥å¿—
- ä½¿ç”¨æ€§èƒ½åˆ†æå·¥å…·å®šä½ç“¶é¢ˆ
- åˆ†ææ‰§è¡Œå†å²æ‰¾å‡ºé—®é¢˜æ¨¡å¼

## è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®ä»£ç å’Œå»ºè®®ï¼è¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. åˆ›å»º Pull Request

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ Apache License 2.0 è®¸å¯è¯ã€‚è¯¦è§ [LICENSE](../../../LICENSE-APACHE) æ–‡ä»¶ã€‚