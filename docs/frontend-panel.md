<!--
 * @Date: 2025-07-01 09:34:09
 * @LastEditors: peng pgs1108pgs@gmail.com
 * @LastEditTime: 2025-07-01 22:55:46
 * @FilePath: /thinking-map/docs/frontend-panel.md
-->
# ThinkingMap 前端：操作面板系统

## 1. 总体布局与结构
- 右侧抽屉式/侧栏面板，默认占界面右侧 35% 宽度，可拖拽调节（最小 25%，最大 50%），支持折叠/展开。
- Tab 垂直排列于面板左侧，内容区右侧。
- 面板内容区根据当前激活 Tab 展示不同内容。
- 顶部区域可显示节点类型、状态、返回/关闭按钮。

## 2. Tab 设计与内容
### 2.1 信息 Tab（节点信息）
- **数据来源**：`node_details`（detail_type: info）、`thinking_nodes` 基础字段
- **展示内容**：
  - 当前问题（多行文本，支持编辑）
  - 目标描述（多行文本，支持编辑）
  - 上下文背景（富文本，支持格式化，内容结构见后端 context 字段）
  - 结论内容（仅在已完成状态显示，只读）
- **依赖检查**：
  - 展示所有父节点/依赖节点的状态（已完成/未完成）
  - 未满足依赖时禁用"开始执行"按钮，并高亮提示
- **执行控制**：
  - 满足依赖时显示"开始执行"按钮
  - 点击后请求后端判断是否需要拆解，自动跳转到拆解Tab或结论Tab
- **操作按钮**：
  - 保存修改、重置、删除节点（需二次确认）

### 2.2 拆解 Tab（问题拆解）
- **数据来源**：`node_details`（detail_type: decompose）、`messages`（type: 拆解相关）
- **显示条件**：后端判断当前节点需要拆解时显示
- **展示内容**：
  - 聊天式对话区，消息类型包括：
    - 系统消息（拆解进度、节点创建通知等）
    - AI消息（拆解分析、子问题建议等）
    - 用户消息（引导调整、确认修改等）
  - 拆解流程进度（如RAG查询、AI分析、节点创建等步骤）
  - 子问题建议列表，用户可调整/确认
- **交互**：
  - Tab激活后自动开始拆解流程
  - 用户可通过对话输入调整拆解建议
  - 确认后创建子节点，实时同步可视化区
  - 聊天消息与节点变更通过SSE实时同步

### 2.3 结论 Tab（结论生成）
- **数据来源**：`node_details`（detail_type: conclusion）、`messages`（type: 结论相关）
- **显示条件**：节点无需拆解或拆解完成后
- **展示内容**：
  - 聊天式对话区，消息类型包括：
    - AI结论生成、用户追问/补充、系统提示等
  - 信息汇总区：当前节点所有相关信息（问题、目标、上下文、子节点结论等）
  - 结论内容编辑/确认区（最终结论确认后只读）
- **交互**：
  - 用户可提问、要求AI调整或补充结论
  - 结论确认后节点状态变为已完成，内容同步到可视化区

## 3. 交互与状态管理
- Tab切换时自动保存未提交内容或弹出确认
- 面板与节点选中状态联动，切换节点时自动刷新内容
- SSE事件驱动面板内容实时更新（如节点状态、对话消息、结论变更等）
- 支持快捷键（如Ctrl+S保存、Esc关闭面板）

## 4. 样式与体验建议
- 使用shadcn/ui的Tabs、Drawer、Button、Input、Textarea等组件，结合Tailwind CSS实现响应式和美观布局
- Tab标题高亮当前激活项，禁用不可用Tab
- 聊天区消息气泡区分AI/用户/系统，支持滚动、加载动画
- 依赖状态、执行按钮等有明显视觉反馈
- 面板内容区支持自适应高度、溢出滚动

## 5. 代码结构建议
- `PanelDrawer.tsx`：面板主组件，控制开关、宽度、折叠
- `PanelTabs.tsx`：Tab导航与切换
- `PanelInfoTab.tsx`：信息Tab内容与表单
- `PanelDecomposeTab.tsx`：拆解Tab聊天与流程
- `PanelConclusionTab.tsx`：结论Tab聊天与确认
- `PanelDependencyList.tsx`：依赖状态展示
- `PanelChatMessage.tsx`：聊天消息气泡
- `panelStore.ts`：面板相关状态管理

## 6. 示例布局（伪代码）
```jsx
<PanelDrawer>
  <PanelTabs>
    <PanelInfoTab />
    <PanelDecomposeTab />
    <PanelConclusionTab />
  </PanelTabs>
</PanelDrawer>
```

> 操作面板系统应支持内容懒加载、缓存、关键操作二次确认、消息历史回溯等高级功能。 